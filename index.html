<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plataforma Educativa UAQ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'uaq-blue': '#003366',
            'uaq-gold': '#FFCC00',
            'custom-gray': {
              '100': '#f7fafc',
              '200': '#edf2f7',
              '300': '#e2e8f0',
              '400': '#cbd5e0',
              '500': '#a0aec0',
              '600': '#718096',
              '700': '#4a5568',
              '800': '#2d3748',
              '900': '#1a202c',
            },
          }
        }
      }
    }
  </script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.1.0",
    "react/": "https://esm.sh/react@19.1.0/",
    "react-dom/client": "https://esm.sh/react-dom@19.1.0/client",
    "react-dom": "https://esm.sh/react-dom@19.1.0",
    "recharts": "https://esm.sh/recharts@2.15.3",
    "react-router-dom": "https://esm.sh/react-router-dom@7.6.2",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/"
  }
}
</script>
  <!-- Babel Standalone para transpilar JSX y TypeScript en el navegador -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-custom-gray-100">
  <div id="root"></div>
  <script type="text/babel" data-presets="react,typescript" data-type="module">
// Content from types.ts
// Removed export keywords as they are not needed in a single script block for local definitions.

interface User {
  id: string;
  name: string;
  email: string;
  role: 'student' | 'teacher';
  avatarUrl?: string;
}

interface Course {
  id: string;
  name: string;
  imageUrl: string;
  semester: string;
  program: string;
  teacher: User;
  objective: string;
  contentSummary: string[];
  evaluationCriteria: { item: string; weight: string }[];
}

enum ActivityStatus {
  PENDING = 'Pendiente',
  IN_PROGRESS = 'En Curso',
  COMPLETED = 'Terminada',
  GRADED = 'Calificada',
  NOT_SUBMITTED = 'No Entregado',
}

interface Activity {
  id: string;
  courseId: string;
  name: string;
  dueDate: string;
  status: ActivityStatus;
  description: string;
  resources?: { name: string; url: string }[];
  submissionStatus?: ActivityStatus;
  grade?: number;
  maxGrade?: number;
}

interface Message {
  id: string;
  senderId: string;
  receiverId: string;
  content: string;
  timestamp: Date;
  attachment?: { name: string; url: string };
}

interface Chat {
  id: string;
  participants: User[];
  messages: Message[];
  lastMessage?: Message;
}

interface GradeItem {
  activityName: string;
  grade: number | null;
  maxGrade: number;
  feedback?: string;
}

interface AcademicProgress {
  courseId: string;
  grades: GradeItem[];
  finalGrade: number | null;
}

interface Notification {
  id: string;
  message: string;
  read: boolean;
  link?: string;
}

interface CalendarEvent {
  id: string;
  title: string;
  start: Date;
  end: Date;
  description?: string;
}

// Content from data.ts
// Removed import from './types' as types are now in the same scope.
// Removed export keywords.

const mockCurrentUser: User = {
  id: 'user1',
  name: 'Estudiante Ejemplo',
  email: 'estudiante@uaq.mx',
  role: 'student',
  avatarUrl: 'https://picsum.photos/seed/user1/100/100',
};

const mockTeacher: User = {
  id: 'teacher1',
  name: 'Dr. Juan Pérez',
  email: 'juan.perez@uaq.mx',
  role: 'teacher',
  avatarUrl: 'https://picsum.photos/seed/teacher1/100/100',
};

const mockStudents: User[] = [
  { id: 'student1', name: 'Ana López', email: 'ana.lopez@uaq.mx', role: 'student', avatarUrl: 'https://picsum.photos/seed/student1/50/50' },
  { id: 'student2', name: 'Carlos García', email: 'carlos.garcia@uaq.mx', role: 'student', avatarUrl: 'https://picsum.photos/seed/student2/50/50' },
  { id: 'student3', name: 'Laura Martínez', email: 'laura.martinez@uaq.mx', role: 'student', avatarUrl: 'https://picsum.photos/seed/student3/50/50' },
  mockCurrentUser,
];

const mockCourses: Course[] = [
  {
    id: 'course1',
    name: 'Cálculo Diferencial',
    imageUrl: 'https://picsum.photos/seed/calculus/300/200',
    semester: '2024-2',
    program: 'Ingeniería en Software',
    teacher: mockTeacher,
    objective: 'Desarrollar la capacidad de analizar y resolver problemas mediante el uso de los conceptos fundamentales del cálculo diferencial.',
    contentSummary: ['Límites y Continuidad', 'Derivadas', 'Aplicaciones de la Derivada', 'Optimización'],
    evaluationCriteria: [
      { item: 'Examen Parcial 1', weight: '25%' },
      { item: 'Examen Parcial 2', weight: '25%' },
      { item: 'Tareas y Participación', weight: '20%' },
      { item: 'Proyecto Final', weight: '30%' },
    ],
  },
  {
    id: 'course2',
    name: 'Programación Orientada a Objetos',
    imageUrl: 'https://picsum.photos/seed/poo/300/200',
    semester: '2024-2',
    program: 'Ingeniería en Software',
    teacher: { id: 'teacher2', name: 'Dra. María Rodríguez', email: 'maria.rodriguez@uaq.mx', role: 'teacher', avatarUrl: 'https://picsum.photos/seed/teacher2/100/100' },
    objective: 'Comprender los principios de la programación orientada a objetos y aplicarlos en el desarrollo de software.',
    contentSummary: ['Clases y Objetos', 'Herencia', 'Polimorfismo', 'Encapsulamiento', 'Patrones de Diseño'],
     evaluationCriteria: [
      { item: 'Prácticas de Laboratorio', weight: '40%' },
      { item: 'Examen Teórico', weight: '30%' },
      { item: 'Proyecto en Equipo', weight: '30%' },
    ],
  },
  {
    id: 'course3',
    name: 'Bases de Datos',
    imageUrl: 'https://picsum.photos/seed/db/300/200',
    semester: '2023-1',
    program: 'Ingeniería en Computación',
    teacher: mockTeacher,
    objective: 'Diseñar, implementar y administrar sistemas de bases de datos relacionales.',
    contentSummary: ['Modelo Relacional', 'SQL', 'Normalización', 'Transacciones', 'Bases de Datos NoSQL'],
    evaluationCriteria: [
      { item: 'Examen 1', weight: '20%' },
      { item: 'Examen 2', weight: '20%' },
      { item: 'Proyecto BD', weight: '40%' },
      { item: 'Ejercicios SQL', weight: '20%' },
    ],
  },
];

const mockActivities: Activity[] = [
  { id: 'activity1', courseId: 'course1', name: 'Tarea 1: Límites', dueDate: '2024-08-15', status: ActivityStatus.PENDING, description: 'Resolver los ejercicios de límites del capítulo 2.', submissionStatus: ActivityStatus.NOT_SUBMITTED, maxGrade: 100 },
  { id: 'activity2', courseId: 'course1', name: 'Práctica 1: Derivadas', dueDate: '2024-08-01', status: ActivityStatus.GRADED, description: 'Aplicar reglas de derivación.', submissionStatus: ActivityStatus.GRADED, grade: 85, maxGrade: 100 },
  { id: 'activity3', courseId: 'course2', name: 'Proyecto: Sistema de Biblioteca', dueDate: '2024-09-01', status: ActivityStatus.IN_PROGRESS, description: 'Desarrollar un sistema de gestión de biblioteca usando POO.', submissionStatus: ActivityStatus.IN_PROGRESS, maxGrade: 100 },
  { id: 'activity4', courseId: 'course1', name: 'Examen Parcial 1', dueDate: '2024-08-20', status: ActivityStatus.PENDING, description: 'Evaluación de los temas de Límites y Continuidad.', submissionStatus: ActivityStatus.NOT_SUBMITTED, maxGrade: 100 },
  { id: 'activity5', courseId: 'course2', name: 'Entrega Avance 1 Proyecto', dueDate: '2024-08-10', status: ActivityStatus.COMPLETED, description: 'Primer avance del proyecto de POO.', submissionStatus: ActivityStatus.COMPLETED, maxGrade: 100 },
];

const mockMessages: Message[] = [
  { id: 'msg1', senderId: 'teacher1', receiverId: 'user1', content: 'Recuerda la asesoría de mañana.', timestamp: new Date(Date.now() - 3600000 * 2) },
  { id: 'msg2', senderId: 'user1', receiverId: 'teacher1', content: 'Enterado, Dr. Pérez. Ahí estaré.', timestamp: new Date(Date.now() - 3600000) },
  { id: 'msg3', senderId: 'student1', receiverId: 'user1', content: '¿Hiciste la tarea de cálculo?', timestamp: new Date(Date.now() - 7200000) },
];

const mockChats: Chat[] = [
  { id: 'chat1', participants: [mockCurrentUser, mockTeacher], messages: mockMessages.filter(m => (m.senderId === mockCurrentUser.id && m.receiverId === mockTeacher.id) || (m.senderId === mockTeacher.id && m.receiverId === mockCurrentUser.id) ).sort((a,b) => a.timestamp.getTime() - b.timestamp.getTime()), lastMessage: mockMessages[1] },
  { id: 'chat2', participants: [mockCurrentUser, mockStudents[0]], messages: mockMessages.filter(m => (m.senderId === mockCurrentUser.id && m.receiverId === mockStudents[0].id) || (m.senderId === mockStudents[0].id && m.receiverId === mockCurrentUser.id) ).sort((a,b) => a.timestamp.getTime() - b.timestamp.getTime()), lastMessage: mockMessages[2] },
];

const mockCourseAcademicProgress: { [courseId: string]: AcademicProgress } = {
  'course1': {
    courseId: 'course1',
    grades: [
      { activityName: 'Tarea 1: Límites', grade: null, maxGrade: 100 },
      { activityName: 'Práctica 1: Derivadas', grade: 85, maxGrade: 100, feedback: 'Buen trabajo, mejorar formato.' },
      { activityName: 'Examen Parcial 1', grade: null, maxGrade: 100 },
    ],
    finalGrade: null,
  },
  'course2': {
    courseId: 'course2',
    grades: [
      { activityName: 'Práctica de Laboratorio 1', grade: 90, maxGrade: 100 },
      { activityName: 'Práctica de Laboratorio 2', grade: 95, maxGrade: 100 },
    ],
    finalGrade: 92.5,
  }
};

const mockCalendarEvents: CalendarEvent[] = [
  { id: 'event1', title: 'Entrega Tarea 1: Límites (Cálculo)', start: new Date('2024-08-15T23:59:00'), end: new Date('2024-08-15T23:59:00') },
  { id: 'event2', title: 'Examen Parcial 1 (Cálculo)', start: new Date('2024-08-20T09:00:00'), end: new Date('2024-08-20T11:00:00') },
  { id: 'event3', title: 'Asesoría Dr. Pérez', start: new Date('2024-08-10T10:00:00'), end: new Date('2024-08-10T11:00:00'), description: 'Cubículo A-305' },
];

const mockNotifications: Notification[] = [
  { id: 'notif1', message: 'Nueva calificación en Práctica 1: Derivadas.', read: false, link: '#/grades/course1' },
  { id: 'notif2', message: 'Recordatorio: Examen Parcial 1 de Cálculo es mañana.', read: false, link: '#/calendar' },
  { id: 'notif3', message: 'El Prof. Pérez ha añadido un nuevo anuncio en Cálculo Diferencial.', read: true, link: '#/course/course1' },
];

const mockFacultyResources: {id: string, name: string, type: string, link: string}[] = [
  {id: 'res1', name: 'Reglamento Escolar', type: 'PDF', link: '#'},
  {id: 'res2', name: 'Calendario Académico 2024-2', type: 'Documento', link: '#'},
  {id: 'res3', name: 'Formatos de Solicitud', type: 'Web', link: '#'},
  {id: 'res4', name: 'Directorio de la Facultad', type: 'Contacto', link: '#'},
];

// Content from components.tsx
import React, { useState, useCallback, ReactNode, ChangeEvent, useRef } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';


const UaqLogo: React.FC = () => (
  <svg width="40" height="40" viewBox="0 0 268 268" fill="none" xmlns="http://www.w3.org/2000/svg" className="text-uaq-blue">
    <path d="M133.541 268C207.307 268 267.082 207.966 267.082 134C267.082 60.0341 207.307 0 133.541 0C59.7753 0 0 60.0341 0 134C0 207.966 59.7753 268 133.541 268ZM133.541 23.993C193.994 23.993 243.089 73.2386 243.089 134C243.089 194.761 193.994 244.007 133.541 244.007C73.0886 244.007 23.993 194.761 23.993 134C23.993 73.2386 73.0886 23.993 133.541 23.993Z" fill="currentColor"/>
    <path d="M133.208 214.333C147.288 214.333 162.062 211.083 172.937 205.083L177.304 184.25C164.717 190.833 149.675 193.333 136.958 193.333C104.975 193.333 80.9333 177.083 80.9333 141.417C80.9333 106.583 104.975 88.5833 136.958 88.5833C149.942 88.5833 164.983 91.0833 177.304 97.6667L172.937 76.5833C162.062 70.8333 147.288 67.3333 133.208 67.3333C87.0666 67.3333 53.6083 98.9167 53.6083 141.417C53.6083 184.25 87.0666 214.333 133.208 214.333Z" fill="currentColor"/>
    <path d="M198.817 197.5L194.45 176.667C203.158 171.5 211.033 163.083 211.033 150.833C211.033 135.5 197.742 127.333 182.7 127.333H162.067V155.5H180.333C187.333 155.5 190.067 159.083 190.067 163.5C190.067 167.917 187.333 171.5 180.333 171.5H150.067V84.0001H183.033C212.9 84.0001 232.817 99.0834 232.817 125.833C232.817 146.667 220.742 161.083 203.667 169.5L210.208 197.5H198.817Z" fill="currentColor"/>
  </svg>
);

const SearchIcon: React.FC<{ className?: string }> = ({ className = "w-5 h-5" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
  </svg>
);

const BellIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
  </svg>
);

const ChartBarIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
  </svg>
);

const CogIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M9.594 3.94c.09-.542.56-1.003 1.116-1.003h2.58c.556 0 1.026.461 1.116 1.003L15.65 6.354a1.375 1.375 0 001.077 1.077l2.415.705c.542.09.901.56.901 1.116v2.58c0 .556-.359 1.026-.901 1.116l-2.415.705a1.375 1.375 0 00-1.077 1.077l-.705 2.415c-.09.542-.56 1.003-1.116 1.003h-2.58c-.556 0-1.026-.461-1.116-1.003l-.705-2.415a1.375 1.375 0 00-1.077-1.077l-2.415-.705c-.542-.09-.901-.56-.901-1.116v-2.58c0-.556.359 1.026.901 1.116l2.415-.705A1.375 1.375 0 009.594 3.94zM12 8.25a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5z" />
  </svg>
);

const CalendarIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-3.75h.008v.008H12v-.008z" />
  </svg>
);

const HomeIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
  </svg>
);

const QuestionMarkCircleIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
    </svg>
);


const BookOpenIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
  </svg>
);

const ClipboardDocumentListIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.172a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM10.5 16.5h.008v.008h-.008V16.5zm0-3h.008v.008h-.008V13.5zm0-3h.008v.008h-.008V10.5z" />
  </svg>
);

const UsersIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
  </svg>
);

const PaperAirplaneIcon: React.FC<{ className?: string }> = ({ className = "w-5 h-5" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
  </svg>
);

const PaperClipIcon: React.FC<{ className?: string }> = ({ className = "w-5 h-5" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.122 2.122l7.81-7.81" />
  </svg>
);

const CheckCircleIcon: React.FC<{ className?: string; title?: string }> = ({ className = "w-5 h-5 text-green-500", title }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    {title && <title>{title}</title>}
    <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
);

const XCircleIcon: React.FC<{ className?: string; title?: string }> = ({ className = "w-5 h-5 text-red-500", title }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    {title && <title>{title}</title>}
    <path strokeLinecap="round" strokeLinejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
);

const ClockIcon: React.FC<{ className?: string; title?: string }> = ({ className = "w-5 h-5 text-yellow-500", title }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    {title && <title>{title}</title>}
    <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
);

const AcademicCapIcon: React.FC<{ className?: string; title?: string }> = ({ className = "w-5 h-5 text-blue-500", title }) => (
   <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    {title && <title>{title}</title>}
    <path d="M12 14.25L5.25 9.75M12 14.25L18.75 9.75M12 14.25V21M12 3L20.25 7.5M12 3L3.75 7.5M12 3V7.5M21 12C21 16.0355 17.0355 19.5 12 19.5C6.96451 19.5 3 16.0355 3 12C3 7.96451 6.96451 4.5 12 4.5C17.0355 4.5 21 7.96451 21 12Z" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
  </svg>
);

const DocumentArrowDownIcon: React.FC<{ className?: string }> = ({ className = "w-5 h-5" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
  </svg>
);

const ArrowUpTrayIcon: React.FC<{ className?: string }> = ({ className = "w-6 h-6" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
  </svg>
);

const EyeIcon: React.FC<{ className?: string }> = ({ className = "w-5 h-5" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
    <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
  </svg>
);

const EyeSlashIcon: React.FC<{ className?: string }> = ({ className = "w-5 h-5" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
  </svg>
);

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'danger' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  children: ReactNode;
}

const Button: React.FC<ButtonProps> = ({ children, variant = 'primary', size = 'md', className, ...props }) => {
  const baseStyles = "font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition ease-in-out duration-150 disabled:opacity-50 disabled:cursor-not-allowed";
  const sizeStyles = {
    sm: "px-3 py-1.5 text-sm",
    md: "px-4 py-2 text-base",
    lg: "px-6 py-3 text-lg",
  };
  const variantStyles = {
    primary: "bg-uaq-blue text-white hover:bg-uaq-blue/90 focus:ring-uaq-blue",
    secondary: "bg-uaq-gold text-uaq-blue hover:bg-uaq-gold/90 focus:ring-uaq-gold",
    danger: "bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",
    ghost: "bg-transparent text-gray-700 hover:bg-gray-100 focus:ring-uaq-blue",
  };

  return (
    <button
      className={`${baseStyles} ${sizeStyles[size]} ${variantStyles[variant]} ${className}`}
      {...props}
    >
      {children}
    </button>
  );
};

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  icon?: ReactNode;
}

const Input: React.FC<InputProps> = ({ label, id, error, icon, className, type = "text", ...props }) => {
  const [showPassword, setShowPassword] = useState(false);
  const isPassword = type === "password";

  return (
    <div className="w-full">
      {label && <label htmlFor={id} className="block text-sm font-medium text-gray-700 mb-1">{label}</label>}
      <div className="relative">
        {icon && <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">{icon}</div>}
        <input
          id={id}
          type={isPassword ? (showPassword ? "text" : "password") : type}
          className={`block w-full px-3 py-2 border ${error ? 'border-red-500' : 'border-gray-300'} rounded-md shadow-sm focus:ring-uaq-blue focus:border-uaq-blue sm:text-sm ${icon ? 'pl-10' : ''} ${className} ${isPassword ? 'pr-10' : ''}`}
          {...props}
        />
        {isPassword && (
          <button
            type="button"
            onClick={() => setShowPassword(!showPassword)}
            className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700"
            aria-label={showPassword ? "Ocultar contraseña" : "Mostrar contraseña"}
          >
            {showPassword ? <EyeSlashIcon className="h-5 w-5" /> : <EyeIcon className="h-5 w-5" />}
          </button>
        )}
      </div>
      {error && <p className="mt-1 text-xs text-red-600">{error}</p>}
    </div>
  );
};

const SearchBar: React.FC<{ onSearch: (term: string) => void; placeholder?: string }> = ({ onSearch, placeholder = "Buscar recursos..." }) => {
  const [searchTerm, setSearchTerm] = useState('');

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    onSearch(searchTerm);
  };

  return (
    <form onSubmit={handleSearch} className="relative w-full max-w-md">
      <Input
        type="search"
        placeholder={placeholder}
        value={searchTerm}
        onChange={(e) => setSearchTerm(e.target.value)}
        icon={<SearchIcon className="w-5 h-5 text-gray-400" />}
        className="pl-10"
      />
    </form>
  );
};

interface NotificationBadgeProps {
  count: number;
}
const NotificationBadge: React.FC<NotificationBadgeProps> = ({ count }) => {
  if (count === 0) return null;
  return (
    <span className="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full transform translate-x-1/2 -translate-y-1/2">
      {count}
    </span>
  );
};

interface CourseCardProps {
  course: Course;
  onCourseSelect: (courseId: string) => void;
}

const CourseCard: React.FC<CourseCardProps> = ({ course, onCourseSelect }) => {
  return (
    <div 
      className="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 cursor-pointer flex flex-col"
      onClick={() => onCourseSelect(course.id)}
      role="button"
      tabIndex={0}
      onKeyPress={(e) => e.key === 'Enter' && onCourseSelect(course.id)}
      aria-label={`Ir al curso ${course.name}`}
    >
      <img src={course.imageUrl} alt={course.name} className="w-full h-40 object-cover"/>
      <div className="p-4 flex flex-col flex-grow">
        <h3 className="text-lg font-semibold text-uaq-blue mb-1">{course.name}</h3>
        <p className="text-sm text-custom-gray-600 mb-1">{course.program}</p>
        <p className="text-xs text-custom-gray-500 mb-2">Semestre: {course.semester}</p>
        <div className="mt-auto pt-2">
            <Button variant="primary" size="sm" className="w-full" onClick={(e) => { e.stopPropagation(); onCourseSelect(course.id);}}>
                Ir al curso
            </Button>
        </div>
      </div>
    </div>
  );
};

const ActivityStatusIcon: React.FC<{ status: ActivityStatus }> = ({ status }) => {
  switch (status) {
    case ActivityStatus.PENDING:
      return <ClockIcon className="w-5 h-5 text-yellow-500" title="Pendiente"/>;
    case ActivityStatus.IN_PROGRESS:
      return <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5 text-blue-500">
        <title>En Curso</title>
        <path fillRule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.216-5.228L8.25 3.065V2.75a.75.75 0 00-1.5 0V3.5A5.5 5.5 0 015.373 9.42l-1.93 3.344a.75.75 0 001.3.752l1.93-3.344a3.999 3.999 0 007.876.732l1.93 3.343a.75.75 0 101.3-.752l-1.93-3.343zM6.575 12.08a.75.75 0 00-1.3 0l-.676 1.172a.75.75 0 00.65.948h1.352a.75.75 0 00.65-.948l-.676-1.172zm8.85 0a.75.75 0 00-1.3 0l-.676 1.172a.75.75 0 00.65.948h1.352a.75.75 0 00.65-.948l-.676-1.172z" clipRule="evenodd" />
      </svg>;
    case ActivityStatus.COMPLETED:
      return <CheckCircleIcon className="w-5 h-5 text-green-600" title="Terminada"/>;
    case ActivityStatus.GRADED:
      return <AcademicCapIcon className="w-5 h-5 text-uaq-blue" title="Calificada"/>;
    case ActivityStatus.NOT_SUBMITTED:
      return <XCircleIcon className="w-5 h-5 text-red-600" title="No Entregado"/>;
    default:
      return null;
  }
};

interface ActivityCardProps {
  activity: Activity;
  onActivitySelect: (activityId: string) => void;
}

const ActivityCard: React.FC<ActivityCardProps> = ({ activity, onActivitySelect }) => {
  return (
    <div 
      className="bg-white p-4 rounded-lg shadow hover:shadow-md transition-shadow duration-200 cursor-pointer"
      onClick={() => onActivitySelect(activity.id)}
      role="button"
      tabIndex={0}
      onKeyPress={(e) => e.key === 'Enter' && onActivitySelect(activity.id)}
      aria-label={`Ver detalles de la actividad ${activity.name}`}
    >
      <div className="flex justify-between items-start">
        <h4 className="text-md font-semibold text-uaq-blue mb-1 w-5/6">{activity.name}</h4>
        <ActivityStatusIcon status={activity.submissionStatus || activity.status} />
      </div>
      <p className="text-xs text-custom-gray-500 mb-2">Fecha Límite: {new Date(activity.dueDate).toLocaleDateString()}</p>
      <p className="text-sm text-custom-gray-700 truncate">{activity.description}</p>
    </div>
  );
};

interface FileUploadProps {
  onFileUpload: (file: File | null) => void;
  currentFile: File | null;
}
const FileUpload: React.FC<FileUploadProps> = ({ onFileUpload, currentFile }) => {
  const [dragActive, setDragActive] = useState(false);
  const inputRef = useRef<HTMLInputElement>(null); 

  const handleDrag = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    if (e.type === "dragenter" || e.type === "dragover") {
      setDragActive(true);
    } else if (e.type === "dragleave") {
      setDragActive(false);
    }
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setDragActive(false);
    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
      onFileUpload(e.dataTransfer.files[0]);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    e.preventDefault();
    if (e.target.files && e.target.files[0]) {
      onFileUpload(e.target.files[0]);
    } else {
      onFileUpload(null);
    }
  };

  const onButtonClick = () => {
    inputRef.current?.click();
  };

  return (
    <div className="w-full">
      <form id="form-file-upload" onDragEnter={handleDrag} onSubmit={(e) => e.preventDefault()} className="relative">
        <input ref={inputRef} type="file" id="input-file-upload" className="hidden" onChange={handleChange} />
        <label 
          id="label-file-upload" 
          htmlFor="input-file-upload" 
          className={`h-48 w-full border-2 rounded-lg flex flex-col items-center justify-center cursor-pointer
                      ${dragActive ? "border-uaq-blue bg-blue-50" : "border-dashed border-custom-gray-400 hover:border-uaq-blue"}`}
          aria-describedby="file-upload-constraints"
        >
          <ArrowUpTrayIcon className={`w-10 h-10 mb-2 ${dragActive ? 'text-uaq-blue' : 'text-custom-gray-500'}`} />
          <p className={`text-center ${dragActive ? 'text-uaq-blue' : 'text-custom-gray-600'}`}>
            Arrastra y suelta archivos aquí, o <span className="font-semibold text-uaq-blue" onClick={onButtonClick} role="button">haz clic para seleccionar</span>
          </p>
          <p id="file-upload-constraints" className="text-xs text-custom-gray-500 mt-1">Soporta: PDF, DOCX, PPTX, JPG, PNG (Max. 10MB)</p>
        </label>
        {dragActive && <div className="absolute inset-0 w-full h-full rounded-lg" onDragEnter={handleDrag} onDragLeave={handleDrag} onDragOver={handleDrag} onDrop={handleDrop}></div>}
      </form>
      {currentFile && (
        <div className="mt-4 p-3 bg-custom-gray-100 rounded-lg flex justify-between items-center">
          <span className="text-sm text-custom-gray-700">{currentFile.name}</span>
          <button onClick={() => onFileUpload(null)} className="text-red-500 hover:text-red-700" aria-label="Remover archivo seleccionado">
            <XCircleIcon className="w-5 h-5"/>
          </button>
        </div>
      )}
      {!currentFile && (
         <p className="mt-2 text-sm text-yellow-600" role="alert">Ningún archivo seleccionado.</p>
      )}
    </div>
  );
};

interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: ReactNode;
  size?: 'sm' | 'md' | 'lg' | 'xl';
}

const Modal: React.FC<ModalProps> = ({ isOpen, onClose, title, children, size = 'md' }) => {
  if (!isOpen) return null;

  const sizeClasses = {
    sm: 'max-w-sm',
    md: 'max-w-md',
    lg: 'max-w-lg',
    xl: 'max-w-xl',
  };

  const modalAnimationStyle = `
    @keyframes fadeInScaleUp {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .animate-fadeInScaleUp { animation: fadeInScaleUp 0.3s forwards; }
  `;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 transition-opacity duration-300 ease-in-out" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div className={`bg-white rounded-lg shadow-xl p-6 w-full ${sizeClasses[size]} transform transition-all duration-300 ease-in-out scale-95 opacity-0 animate-fadeInScaleUp`}>
        <div className="flex justify-between items-center mb-4">
          <h3 id="modal-title" className="text-xl font-semibold text-uaq-blue">{title}</h3>
          <button onClick={onClose} className="text-custom-gray-500 hover:text-custom-gray-700" aria-label="Cerrar modal">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
              <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div>{children}</div>
      </div>
      <style>{modalAnimationStyle}</style>
    </div>
  );
};

interface GradesChartProps {
  grades: GradeItem[];
}
const GradesChart: React.FC<GradesChartProps> = ({ grades }) => {
  const data = grades.map(g => ({
    name: g.activityName.length > 15 ? g.activityName.substring(0,15) + '...' : g.activityName,
    calificacion: g.grade,
    maxima: g.maxGrade
  }));

  return (
    <div className="bg-white p-4 rounded-lg shadow h-80">
      <h4 className="text-lg font-semibold text-uaq-blue mb-4">Progreso de Calificaciones</h4>
      <ResponsiveContainer width="100%" height="100%">
        <BarChart data={data} margin={{ top: 5, right: 20, left: -20, bottom: 40 }} accessibilityLayer>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="name" angle={-30} textAnchor="end" height={50} interval={0} />
          <YAxis allowDecimals={false} domain={[0, 100]} />
          <Tooltip />
          <Legend />
          <Bar dataKey="calificacion" fill="#003366" name="Calificación Obtenida" />
          {/* <Bar dataKey="maxima" fill="#FFCC00" name="Calificación Máxima" /> */}
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
};

interface ResourceSearchResultsProps {
  results: {id: string, name: string, type: string, link: string}[];
}
const ResourceSearchResults: React.FC<ResourceSearchResultsProps> = ({ results }) => {
  if (results.length === 0) {
    return <p className="text-custom-gray-600 mt-4">No se encontraron recursos.</p>;
  }
  return (
    <div className="mt-4 space-y-2">
      {results.map(res => (
        <a key={res.id} href={res.link} target="_blank" rel="noopener noreferrer" className="block p-3 bg-white hover:bg-custom-gray-50 rounded-md shadow">
          <h4 className="font-semibold text-uaq-blue">{res.name}</h4>
          <p className="text-sm text-custom-gray-500">Tipo: {res.type}</p>
        </a>
      ))}
    </div>
  );
};

interface BreadcrumbItem {
  label: string;
  path?: string; 
}
interface BreadcrumbsProps {
  items: BreadcrumbItem[];
  navigate: (path: string) => void; 
}

const Breadcrumbs: React.FC<BreadcrumbsProps> = ({ items, navigate }) => {
  if (items.length === 0) return null;

  return (
    <nav aria-label="breadcrumb" className="text-sm font-medium text-custom-gray-500 mb-4 px-4 md:px-0"> {/* Add padding for standalone use */}
      <ol className="list-none p-0 inline-flex flex-wrap">
        {items.map((item, index) => (
          <li key={index} className="flex items-center">
            {item.path && index < items.length -1 ? ( 
              <a onClick={(e) => { e.preventDefault(); navigate(item.path);}} className="hover:text-uaq-blue cursor-pointer">
                {item.label}
              </a>
            ) : (
              <span className={index === items.length - 1 ? "text-custom-gray-700 font-semibold" : ""}>{item.label}</span>
            )}
            {index < items.length - 1 && (
              <svg className="fill-current w-3 h-3 mx-2 text-custom-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" aria-hidden="true">
                <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
              </svg>
            )}
          </li>
        ))}
      </ol>
    </nav>
  );
};

const GeneralHeader: React.FC<{
  notifications: Notification[];
  onSearch: (term: string) => void;
  setShowSearchResultsModal: (show: boolean) => void;
  navigate: (path: string) => void;
}> = ({ notifications, onSearch, setShowSearchResultsModal, navigate }) => {
  const [showNotifications, setShowNotifications] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const unreadNotifications = notifications.filter(n => !n.read).length;

  return (
    <header className="bg-white shadow-md p-4 sticky top-0 z-40">
      <div className="container mx-auto flex justify-between items-center">
        <a href="#/" onClick={(e) => { e.preventDefault(); navigate('/');}} className="flex items-center space-x-2 cursor-pointer">
          <UaqLogo />
          <span className="text-xl font-semibold text-uaq-blue hidden md:block">Facultad de Informática</span>
        </a>

        <div className="flex-1 max-w-lg mx-4">
          <SearchBar 
            onSearch={(term) => {
              onSearch(term);
              setShowSearchResultsModal(true);
            }} 
            placeholder="Buscar recursos en la facultad..." 
          />
        </div>

        <nav className="flex items-center space-x-3 md:space-x-4">
          <div className="relative">
            <button onClick={() => setShowNotifications(!showNotifications)} className="text-custom-gray-600 hover:text-uaq-blue relative" title="Notificaciones">
              <BellIcon />
              {unreadNotifications > 0 && <NotificationBadge count={unreadNotifications} />}
            </button>
            {showNotifications && (
              <div className="absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg overflow-hidden z-20">
                <div className="py-2 px-3 text-sm font-semibold text-uaq-blue border-b">Notificaciones</div>
                {notifications.length > 0 ? notifications.map(n => (
                  <a key={n.id} href={n.link || '#'} onClick={(e) => {e.preventDefault(); if(n.link) navigate(n.link); setShowNotifications(false);}} className={`block px-4 py-3 text-sm hover:bg-custom-gray-100 ${!n.read ? 'font-medium' : ''}`}>
                    {n.message}
                  </a>
                )) : <p className="px-4 py-3 text-sm text-custom-gray-500">No hay notificaciones nuevas.</p>}
              </div>
            )}
          </div>
          <a href="#/grades" onClick={(e) => { e.preventDefault(); navigate('/grades');}} className="text-custom-gray-600 hover:text-uaq-blue" title="Calificaciones">
            <ChartBarIcon />
          </a>
          <a href="#/calendar" onClick={(e) => { e.preventDefault(); navigate('/calendar');}} className="text-custom-gray-600 hover:text-uaq-blue" title="Calendario">
            <CalendarIcon />
          </a>
          <div className="relative">
            <button onClick={() => setShowSettings(!showSettings)} className="text-custom-gray-600 hover:text-uaq-blue" title="Configuración">
              <CogIcon />
            </button>
            {showSettings && (
              <div className="absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg py-1 z-20">
                <a href="#/settings" onClick={(e) => {e.preventDefault(); navigate('/settings'); setShowSettings(false);}} className="block px-4 py-2 text-sm text-custom-gray-700 hover:bg-custom-gray-100">Mi Perfil</a>
                <a href="#/help" onClick={(e) => {e.preventDefault(); navigate('/help'); setShowSettings(false);}} className="flex items-center px-4 py-2 text-sm text-custom-gray-700 hover:bg-custom-gray-100">
                  <QuestionMarkCircleIcon className="w-5 h-5 mr-2" /> Ayuda y Soporte
                </a>
                <div className="border-t my-1 border-custom-gray-200"></div>
                <a href="#/login" onClick={(e) => {e.preventDefault(); navigate('/login'); setShowSettings(false);}} className="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">Cerrar Sesión</a>
              </div>
            )}
          </div>
          <a href="https://www.uaq.mx" target="_blank" rel="noopener noreferrer" className="text-custom-gray-600 hover:text-uaq-blue" title="Página Principal UAQ">
            <HomeIcon />
          </a>
        </nav>
      </div>
    </header>
  );
};

const LoadingSpinner: React.FC<{ size?: 'sm' | 'md' | 'lg', message?: string, className?: string }> = ({ size = 'md', message, className }) => {
  const sizeClasses = { sm: 'w-6 h-6', md: 'w-8 h-8', lg: 'w-12 h-12' };
  return (
    <div className={`flex flex-col items-center justify-center py-8 ${className}`}>
      <svg className={`animate-spin text-uaq-blue ${sizeClasses[size]}`} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true">
        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      {message && <p className="mt-2 text-custom-gray-600" role="status">{message}</p>}
    </div>
  );
};

// Content from pages.tsx
import React, { useState, useEffect, useCallback } from 'react'; // React, useState, useEffect for pages
import { useParams, useNavigate, useLocation } from 'react-router-dom'; // Specific router hooks for pages

// Components from 'components.tsx' are now globally available in this script block,
// so direct import from './components.tsx' is removed.
// Types from 'types.ts' are also globally available.
// Data from 'data.ts' is also globally available.


const getTabUserFriendlyName = (tabKey: string) => {
  switch (tabKey) {
    case 'home': return 'Página Principal';
    case 'materials': return 'Material';
    case 'activities': return 'Actividades';
    case 'members': return 'Integrantes';
    default: return '';
  }
};

const DashboardPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const [searchTerm, setSearchTerm] = useState('');
  const [filter, setFilter] = useState<{ type: 'semester' | 'program' | 'all', value: string }>({ type: 'all', value: 'all' });
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const timer = setTimeout(() => {
      setLoading(false);
    }, 500);
    return () => clearTimeout(timer);
  }, []);

  const filteredCourses = mockCourses.filter(course => {
    const matchesSearch = course.name.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesFilter = filter.type === 'all' || 
                          (filter.type === 'semester' && course.semester === filter.value) ||
                          (filter.type === 'program' && course.program === filter.value);
    return matchesSearch && matchesFilter;
  });

  const semesters = Array.from(new Set(mockCourses.map(c => c.semester)));
  const programs = Array.from(new Set(mockCourses.map(c => c.program)));

  const breadcrumbItems: BreadcrumbItem[] = [{ label: 'Mis Cursos' }];

  if (loading) {
    return <LoadingSpinner message="Cargando cursos..." className="mt-20" />;
  }

  return (
    <div className="container mx-auto p-4 md:p-8">
      <Breadcrumbs items={breadcrumbItems} navigate={navigate} />
      <h1 className="text-3xl font-bold text-uaq-blue mb-6">Mis Cursos</h1>
      
      <div className="mb-6 flex flex-col md:flex-row gap-4 items-center">
        <Input 
          type="text"
          placeholder="Buscar curso por nombre..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="max-w-md flex-grow"
          icon={<SearchIcon className="w-4 h-4 text-gray-400"/>}
          aria-label="Buscar curso por nombre"
        />
        <select 
          value={`${filter.type}-${filter.value}`}
          onChange={(e) => {
            const [type, value] = e.target.value.split('-');
            setFilter({ type: type as 'semester' | 'program' | 'all', value });
          }}
          className="p-2 border border-custom-gray-300 rounded-md shadow-sm focus:ring-uaq-blue focus:border-uaq-blue"
          aria-label="Filtrar cursos"
        >
          <option value="all-all">Todos los Cursos</option>
          <optgroup label="Por Semestre">
            {semesters.map(s => <option key={s} value={`semester-${s}`}>{s}</option>)}
          </optgroup>
          <optgroup label="Por Programa">
            {programs.map(p => <option key={p} value={`program-${p}`}>{p}</option>)}
          </optgroup>
        </select>
      </div>

      {filteredCourses.length > 0 ? (
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {filteredCourses.map(course => (
            <CourseCard key={course.id} course={course} onCourseSelect={(id) => navigate(`/course/${id}`)} />
          ))}
        </div>
      ) : (
        <p className="text-center text-custom-gray-600 text-lg">No se encontraron cursos que coincidan con tu búsqueda o filtro.</p>
      )}
    </div>
  );
};

const CoursePage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const { courseId } = useParams<{ courseId: string }>();
  const location = useLocation();
  const [course, setCourse] = useState<Course | null>(null);
  const [loading, setLoading] = useState(true);
  
  const currentTabFromPath = () => {
    const pathParts = location.pathname.split('/');
    if (pathParts.length > 3 && ['home', 'materials', 'activities', 'members'].includes(pathParts[3])) return pathParts[3];
    return 'home';
  };
  const [activeTab, setActiveTab] = useState<'home' | 'materials' | 'activities' | 'members'>(currentTabFromPath() as 'home' | 'materials' | 'activities' | 'members');


  useEffect(() => {
    setLoading(true);
    const timer = setTimeout(() => {
      const foundCourse = mockCourses.find(c => c.id === courseId);
      setCourse(foundCourse || null);
      setActiveTab(currentTabFromPath() as 'home' | 'materials' | 'activities' | 'members');
      setLoading(false);
    }, 500);
    return () => clearTimeout(timer);
  }, [courseId, location.pathname]);

  const handleTabChange = (tab: 'home' | 'materials' | 'activities' | 'members') => {
    setActiveTab(tab);
    navigate(`/course/${courseId}/${tab}`);
  };
  
  if (loading) {
    return <LoadingSpinner message="Cargando información del curso..." className="mt-20" />;
  }

  if (!course) {
    return <div className="text-center p-8">Curso no encontrado. <Button onClick={() => navigate('/')}>Volver a Mis Cursos</Button></div>;
  }

  const breadcrumbItems: BreadcrumbItem[] = [
    { label: 'Mis Cursos', path: '/' },
    { label: course.name, path: `/course/${courseId}/home` },
  ];
  const tabFriendlyName = getTabUserFriendlyName(activeTab);
  if (activeTab !== 'home' && tabFriendlyName) {
    breadcrumbItems.push({ label: tabFriendlyName });
  }


  const CoursePageHeader: React.FC<{ courseName: string, activeTab: string, onTabChange: (tab: 'home' | 'materials' | 'activities' | 'members') => void }> = ({ courseName, activeTab, onTabChange }) => (
    <div className="bg-white shadow-sm sticky top-[72px] z-30">
      <div className="container mx-auto px-4">
        <div className="flex flex-col md:flex-row justify-between items-center py-4">
          <h2 className="text-2xl font-semibold text-uaq-blue mb-2 md:mb-0">{courseName}</h2>
        </div>
        <nav className="flex border-b overflow-x-auto">
          {[
            { id: 'home', label: 'Página Principal', icon: <HomeIcon className="w-4 h-4 mr-1 md:mr-2"/> },
            { id: 'materials', label: 'Material', icon: <BookOpenIcon className="w-4 h-4 mr-1 md:mr-2"/> },
            { id: 'activities', label: 'Actividades', icon: <ClipboardDocumentListIcon className="w-4 h-4 mr-1 md:mr-2"/> },
            { id: 'members', label: 'Integrantes', icon: <UsersIcon className="w-4 h-4 mr-1 md:mr-2"/> },
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => onTabChange(tab.id as 'home' | 'materials' | 'activities' | 'members')}
              className={`flex items-center px-3 py-3 md:px-4 text-sm font-medium border-b-2 transition-colors duration-150 whitespace-nowrap
                ${activeTab === tab.id 
                  ? 'border-uaq-blue text-uaq-blue' 
                  : 'border-transparent text-custom-gray-600 hover:text-uaq-blue hover:border-custom-gray-300'}`}
              aria-current={activeTab === tab.id ? 'page' : undefined}
            >
              {tab.icon} {tab.label}
            </button>
          ))}
        </nav>
      </div>
    </div>
  );
  
  const renderTabContent = () => {
    switch (activeTab) {
      case 'home': return <CourseHomePage course={course} navigate={navigate}/>;
      case 'materials': return <CourseMaterialsPage course={course} />;
      case 'activities': return <CourseActivitiesPage courseId={course.id} navigate={navigate} />;
      case 'members': return <CourseMembersPage course={course} />;
      default: return <CourseHomePage course={course} navigate={navigate} />;
    }
  };

  return (
    <>
      <CoursePageHeader courseName={course.name} activeTab={activeTab} onTabChange={handleTabChange}/>
      <div className="container mx-auto">
        <Breadcrumbs items={breadcrumbItems} navigate={navigate} />
        <div className="p-4 md:p-6 pt-0 md:pt-0">
         {renderTabContent()}
        </div>
      </div>
    </>
  );
};

const CourseHomePage: React.FC<{ course: Course, navigate: (path: string) => void }> = ({ course, navigate }) => (
  <div className="space-y-6">
    <section className="bg-white p-6 rounded-lg shadow">
      <h3 className="text-xl font-semibold text-uaq-blue mb-3">Información del Docente</h3>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <p><strong>Nombre:</strong> {course.teacher.name}</p>
          <p><strong>Correo:</strong> <a href={`mailto:${course.teacher.email}`} className="text-uaq-gold hover:underline">{course.teacher.email}</a></p>
        </div>
        <div>
          <p><strong>Horarios de Asesoría:</strong> Lunes y Miércoles 10-11 AM (Ejemplo)</p>
          <p><strong>Cubículo:</strong> A-101 (Ejemplo)</p>
        </div>
      </div>
    </section>
    
    <section className="bg-white p-6 rounded-lg shadow">
      <h3 className="text-xl font-semibold text-uaq-blue mb-3">Objetivo del Curso</h3>
      <p className="text-custom-gray-700">{course.objective}</p>
    </section>

    <section className="bg-white p-6 rounded-lg shadow">
      <h3 className="text-xl font-semibold text-uaq-blue mb-3">Contenido del Curso</h3>
      <ul className="list-disc list-inside text-custom-gray-700 space-y-1">
        {course.contentSummary.map((item, index) => <li key={index}>{item}</li>)}
      </ul>
    </section>

    <section className="bg-white p-6 rounded-lg shadow">
      <h3 className="text-xl font-semibold text-uaq-blue mb-3">Criterios de Evaluación</h3>
      <ul className="list-disc list-inside text-custom-gray-700 space-y-1">
        {course.evaluationCriteria.map((crit, index) => <li key={index}><strong>{crit.item}:</strong> {crit.weight}</li>)}
      </ul>
    </section>
    
    <section className="bg-white p-6 rounded-lg shadow">
      <h3 className="text-xl font-semibold text-uaq-blue mb-3">Anuncios Recientes</h3>
      <div className="border-l-4 border-uaq-gold p-4 bg-yellow-50 text-yellow-800">
        <p>¡Bienvenidos al curso! Recuerden revisar la sección de actividades semanalmente.</p>
        <p className="mt-2 text-sm">Publicado: {new Date().toLocaleDateString()}</p>
      </div>
    </section>

     <Button onClick={() => navigate(`/grades/${course.id}`)} variant="secondary">
      Ver Progreso Académico
    </Button>
  </div>
);

const CourseMaterialsPage: React.FC<{ course: Course }> = ({ course }) => (
  <div className="bg-white p-6 rounded-lg shadow">
    <h3 className="text-xl font-semibold text-uaq-blue mb-4">Material de la Materia: {course.name}</h3>
    <p className="text-custom-gray-700 mb-4">Aquí encontrarás presentaciones, lecturas, y otros recursos relevantes para el curso.</p>
    <ul className="space-y-3">
      <li className="p-3 border rounded-md hover:bg-custom-gray-50 flex justify-between items-center">
        <span>Presentación Tema 1: Introducción <span className="text-xs text-uaq-gold ml-2">(PDF)</span></span>
        <Button variant="ghost" size="sm">Descargar</Button>
      </li>
      <li className="p-3 border rounded-md hover:bg-custom-gray-50 flex justify-between items-center">
        <span>Lectura Complementaria: Artículo sobre X <span className="text-xs text-uaq-gold ml-2">(Enlace Externo)</span></span>
         <Button variant="ghost" size="sm" onClick={() => window.open('#', '_blank')}>Abrir Enlace</Button>
      </li>
      <li className="p-3 border rounded-md hover:bg-custom-gray-50 flex justify-between items-center">
        <span>Código de Ejemplo: Estructuras de Datos <span className="text-xs text-uaq-gold ml-2">(ZIP)</span></span>
        <Button variant="ghost" size="sm">Descargar</Button>
      </li>
    </ul>
    <div className="mt-6 p-4 border-t border-custom-gray-200">
      <h4 className="font-semibold text-uaq-blue mb-2">Integración con Google Drive</h4>
      <p className="text-sm text-custom-gray-600 mb-2">Accede a los archivos del curso directamente desde Google Drive.</p>
      <Button variant="primary" size="sm" onClick={() => alert('Integración con Google Drive (simulada)')}>Conectar Google Drive</Button>
    </div>
  </div>
);

const CourseActivitiesPage: React.FC<{ courseId: string, navigate: (path: string) => void }> = ({ courseId, navigate }) => {
  const activities = mockActivities.filter(act => act.courseId === courseId);
  
  const categorizeActivities = (status: ActivityStatus) => activities.filter(act => {
    const effectiveStatus = act.submissionStatus || act.status;
    if (status === ActivityStatus.PENDING) return effectiveStatus === ActivityStatus.PENDING || effectiveStatus === ActivityStatus.NOT_SUBMITTED;
    if (status === ActivityStatus.IN_PROGRESS) return effectiveStatus === ActivityStatus.IN_PROGRESS;
    if (status === ActivityStatus.COMPLETED) return effectiveStatus === ActivityStatus.COMPLETED || effectiveStatus === ActivityStatus.GRADED;
    return false;
  });

  const recentActivities = [...activities].sort((a,b) => new Date(b.dueDate).getTime() - new Date(a.dueDate).getTime()).slice(0, 5);
  const pendingActivities = categorizeActivities(ActivityStatus.PENDING);
  const inProgressActivities = categorizeActivities(ActivityStatus.IN_PROGRESS);
  const completedActivities = categorizeActivities(ActivityStatus.COMPLETED);

  const ActivityColumn: React.FC<{title: string, activities: Activity[], onActivitySelect: (id: string) => void}> = ({title, activities, onActivitySelect}) => (
    <div className="bg-custom-gray-100 p-4 rounded-lg min-w-[280px] md:min-w-[300px] flex-shrink-0">
      <h3 className="text-lg font-semibold text-uaq-blue mb-4">{title} ({activities.length})</h3>
      {activities.length > 0 ? (
        <div className="space-y-3">
          {activities.map(act => <ActivityCard key={act.id} activity={act} onActivitySelect={onActivitySelect} />)}
        </div>
      ) : <p className="text-sm text-custom-gray-500">No hay actividades en esta categoría.</p>}
    </div>
  );

  return (
    <div className="space-y-6">
      <h3 className="text-2xl font-bold text-uaq-blue mb-1">Actividades del Curso</h3>
      <p className="text-custom-gray-600 mb-6">Organiza y accede a todas tus actividades.</p>
      
      <div className="flex overflow-x-auto space-x-4 pb-4 -mx-4 px-4">
        <ActivityColumn title="Recientes" activities={recentActivities} onActivitySelect={(id) => navigate(`/course/${courseId}/activity/${id}`)} />
        <ActivityColumn title="Pendientes" activities={pendingActivities} onActivitySelect={(id) => navigate(`/course/${courseId}/activity/${id}`)} />
        <ActivityColumn title="En Curso" activities={inProgressActivities} onActivitySelect={(id) => navigate(`/course/${courseId}/activity/${id}`)} />
        <ActivityColumn title="Terminadas/Calificadas" activities={completedActivities} onActivitySelect={(id) => navigate(`/course/${courseId}/activity/${id}`)} />
      </div>
    </div>
  );
};

const CourseMembersPage: React.FC<{ course: Course }> = ({ course }) => {
  const teacher = course.teacher;
  const studentsInCourse = mockStudents.filter(s => s.id !== teacher.id); 

  return (
    <div className="bg-white p-6 rounded-lg shadow">
      <h3 className="text-xl font-semibold text-uaq-blue mb-4">Integrantes del Curso: {course.name}</h3>
      
      <section className="mb-6">
        <h4 className="text-lg font-medium text-custom-gray-800 mb-2">Profesor</h4>
        <div className="flex items-center space-x-3 p-3 border rounded-md">
          <img src={teacher.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(teacher.name)}&background=003366&color=fff&size=128`} alt={teacher.name} className="w-10 h-10 rounded-full"/>
          <div>
            <p className="font-semibold">{teacher.name}</p>
            <a href={`mailto:${teacher.email}`} className="text-sm text-uaq-gold hover:underline">{teacher.email}</a>
          </div>
          <Button size="sm" variant="ghost" className="ml-auto" onClick={() => alert(`Contactar a ${teacher.name} (simulado)`)}>Contactar</Button>
        </div>
      </section>

      <section>
        <h4 className="text-lg font-medium text-custom-gray-800 mb-2">Alumnos ({studentsInCourse.length})</h4>
        <div className="space-y-2 max-h-96 overflow-y-auto">
          {studentsInCourse.map(student => (
            <div key={student.id} className="flex items-center space-x-3 p-3 border rounded-md">
              <img src={student.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(student.name)}&background=E0E7FF&color=4A5568&size=128`} alt={student.name} className="w-8 h-8 rounded-full"/>
              <div>
                <p>{student.name}</p>
                 <a href={`mailto:${student.email}`} className="text-xs text-custom-gray-500 hover:underline">{student.email}</a>
              </div>
              <Button size="sm" variant="ghost" className="ml-auto" onClick={() => alert(`Contactar a ${student.name} (simulado)`)}>Contactar</Button>
            </div>
          ))}
        </div>
      </section>
    </div>
  );
};

const ActivityDetailPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const { courseId, activityId } = useParams<{ courseId: string, activityId: string }>();
  const [activity, setActivity] = useState<Activity | null>(null);
  const [courseName, setCourseName] = useState<string>('');
  const [file, setFile] = useState<File | null>(null);
  const [loading, setLoading] = useState(true);
  const [isConfirmModalOpen, setIsConfirmModalOpen] = useState(false);

  useEffect(() => {
    setLoading(true);
    const timer = setTimeout(() => {
      const foundActivity = mockActivities.find(act => act.id === activityId && act.courseId === courseId);
      setActivity(foundActivity || null);
      const foundCourse = mockCourses.find(c => c.id === courseId);
      setCourseName(foundCourse?.name || '');
      setLoading(false);
    }, 500);
    return () => clearTimeout(timer);
  }, [courseId, activityId]);

  const handleFileUpload = (uploadedFile: File | null) => {
    setFile(uploadedFile);
  };
  
  const handleAttemptSubmit = () => {
    if(!file) {
      alert("Por favor, selecciona un archivo para entregar.");
      return;
    }
    setIsConfirmModalOpen(true);
  };

  const handleConfirmSubmit = () => {
    setIsConfirmModalOpen(false);
    if(file && activity){
      setLoading(true); 
      setTimeout(() => {
        const updatedActivity = {...activity, submissionStatus: ActivityStatus.COMPLETED, status: ActivityStatus.COMPLETED};
        const index = mockActivities.findIndex(a => a.id === activity.id);
        if(index !== -1) mockActivities[index] = updatedActivity;
        setActivity(updatedActivity);
        setLoading(false);
        alert(`Archivo "${file.name}" entregado para "${activity.name}".`);
      }, 1000);
    }
  };

  if (loading && !isConfirmModalOpen) {
    return <LoadingSpinner message="Cargando detalles de la actividad..." className="mt-20" />;
  }

  if (!activity) {
    return <div className="text-center p-8">Actividad no encontrada. <Button onClick={() => navigate(`/course/${courseId}/activities`)}>Volver a Actividades</Button></div>;
  }

  const breadcrumbItems: BreadcrumbItem[] = [
    { label: 'Mis Cursos', path: '/' },
    { label: courseName, path: `/course/${courseId}/home` },
    { label: 'Actividades', path: `/course/${courseId}/activities` },
    { label: activity.name }
  ];
  
  const canSubmit = activity.submissionStatus !== ActivityStatus.GRADED && activity.submissionStatus !== ActivityStatus.COMPLETED;

  return (
    <div className="container mx-auto">
      <Breadcrumbs items={breadcrumbItems} navigate={navigate} />
      <div className="p-4 md:p-6 pt-0 md:pt-0">
        <Button onClick={() => navigate(`/course/${courseId}/activities`)} variant="ghost" size="sm" className="mb-4">
          &larr; Volver a Actividades de {courseName}
        </Button>
        <div className="bg-white p-6 rounded-lg shadow space-y-6">
          <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center">
              <h1 className="text-2xl font-bold text-uaq-blue mb-2 sm:mb-0">{activity.name}</h1>
              <div className="flex items-center space-x-2">
                  <span className="text-sm text-custom-gray-600">Estado:</span>
                  <ActivityStatusIcon status={activity.submissionStatus || ActivityStatus.NOT_SUBMITTED} />
                  <span className="text-sm font-medium">{activity.submissionStatus || ActivityStatus.NOT_SUBMITTED}</span>
              </div>
          </div>
          
          <p className="text-sm text-custom-gray-500">Fecha Límite: {new Date(activity.dueDate).toLocaleString()}</p>
          
          <div>
            <h3 className="text-lg font-semibold text-uaq-blue mb-2">Descripción Detallada</h3>
            <p className="text-custom-gray-700 whitespace-pre-line">{activity.description}</p>
          </div>

          {activity.resources && activity.resources.length > 0 && (
            <div>
              <h3 className="text-lg font-semibold text-uaq-blue mb-2">Recursos Descargables</h3>
              <ul className="space-y-2">
                {activity.resources.map(res => (
                  <li key={res.name}>
                    <a href={res.url} download className="text-uaq-gold hover:underline flex items-center">
                      <ClipboardDocumentListIcon className="w-5 h-5 mr-2"/> {res.name}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          )}

          <div className="border-t pt-6">
            <h3 className="text-lg font-semibold text-uaq-blue mb-3">Panel de Entrega</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 items-center mb-4">
              <div>
                <p><strong>Estado de la Entrega:</strong> <span className={`font-semibold ${activity.submissionStatus === ActivityStatus.GRADED ? 'text-green-600' : 'text-custom-gray-700'}`}>{activity.submissionStatus || ActivityStatus.NOT_SUBMITTED}</span></p>
                {activity.submissionStatus === ActivityStatus.GRADED && activity.grade !== undefined && (
                  <p><strong>Calificación:</strong> <span className="font-bold text-uaq-blue">{activity.grade}/{activity.maxGrade || 100}</span></p>
                )}
              </div>
            </div>
            
            {canSubmit && (
               <>
                  <h4 className="text-md font-semibold text-custom-gray-800 mb-2">Subir Archivo</h4>
                  <FileUpload onFileUpload={handleFileUpload} currentFile={file} />
                  <Button onClick={handleAttemptSubmit} className="mt-4" disabled={!file || loading}>
                    {loading ? 'Procesando...' : 'Entregar Actividad'}
                  </Button>
               </>
            )}

            {activity.submissionStatus === ActivityStatus.COMPLETED && !activity.grade && (
              <p className="mt-4 p-3 bg-green-50 text-green-700 rounded-md">Ya has entregado esta actividad. Esperando calificación.</p>
            )}

             {activity.submissionStatus === ActivityStatus.GRADED && activity.grade !== undefined && (
               <div className="mt-4 p-3 bg-blue-50 text-uaq-blue rounded-md">
                  <p><strong>Retroalimentación:</strong> {mockCourseAcademicProgress[courseId || '']?.grades.find(g => g.activityName.includes(activity.name))?.feedback || 'Sin retroalimentación adicional.'}</p>
               </div>
             )}
          </div>
        </div>
      </div>
      <Modal 
        isOpen={isConfirmModalOpen}
        onClose={() => setIsConfirmModalOpen(false)}
        title="Confirmar Entrega"
      >
        <p className="text-custom-gray-700 mb-6">¿Estás seguro de que deseas entregar el archivo "{file?.name}"? Esta acción no se puede deshacer.</p>
        <div className="flex justify-end space-x-3">
          <Button variant="ghost" onClick={() => setIsConfirmModalOpen(false)}>Cancelar</Button>
          <Button variant="primary" onClick={handleConfirmSubmit}>Confirmar Entrega</Button>
        </div>
      </Modal>
    </div>
  );
};

const MessagingPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const [chats, setChats] = useState<typeof mockChats>(mockChats);
  const [selectedChat, setSelectedChat] = useState<typeof mockChats[0] | null>(chats[0] || null);
  const [newMessage, setNewMessage] = useState('');
  const [searchTerm, setSearchTerm] = useState('');

  const handleSendMessage = () => {
    if (!newMessage.trim() || !selectedChat) return;
    const message: Message = {
      id: `msg${Date.now()}`,
      senderId: mockCurrentUser.id,
      receiverId: selectedChat.participants.find(p => p.id !== mockCurrentUser.id)?.id || '',
      content: newMessage,
      timestamp: new Date(),
    };
    
    const updatedChats = chats.map(chat => 
      chat.id === selectedChat.id 
        ? { ...chat, messages: [...chat.messages, message], lastMessage: message } 
        : chat
    );
    setChats(updatedChats.sort((a,b) => (b.lastMessage?.timestamp.getTime() || 0) - (a.lastMessage?.timestamp.getTime() || 0) ));
    setSelectedChat(prev => prev ? {...prev, messages: [...prev.messages, message], lastMessage: message} : null);
    setNewMessage('');
  };
  
  const filteredChats = chats.filter(chat => {
    const otherParticipant = chat.participants.find(p => p.id !== mockCurrentUser.id);
    return otherParticipant?.name.toLowerCase().includes(searchTerm.toLowerCase());
  }).sort((a,b) => (b.lastMessage?.timestamp.getTime() || 0) - (a.lastMessage?.timestamp.getTime() || 0) );

  const breadcrumbItems: BreadcrumbItem[] = [
    { label: 'Mis Cursos', path: '/' },
    { label: 'Mensajería' }
  ];

  return (
    <div className="flex flex-col h-[calc(100vh-72px-40px)]">
        <div className="container mx-auto">
            <Breadcrumbs items={breadcrumbItems} navigate={navigate} />
        </div>
        <div className="container mx-auto flex flex-grow h-[calc(100%-2rem)] shadow-lg rounded-lg overflow-hidden">
            <div className="w-full md:w-1/3 border-r border-custom-gray-300 bg-white flex flex-col">
                <div className="p-4 border-b">
                <Input 
                    type="search" 
                    placeholder="Buscar contactos..." 
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    icon={<SearchIcon className="w-4 h-4 text-gray-400"/>}
                    aria-label="Buscar contactos o iniciar chat"
                />
                </div>
                <div className="overflow-y-auto flex-grow">
                {filteredChats.map(chat => {
                    const otherUser = chat.participants.find(p => p.id !== mockCurrentUser.id);
                    if (!otherUser) return null;
                    return (
                    <div 
                        key={chat.id} 
                        onClick={() => setSelectedChat(chat)}
                        className={`p-4 flex items-center space-x-3 cursor-pointer hover:bg-custom-gray-100 ${selectedChat?.id === chat.id ? 'bg-custom-gray-100 border-r-4 border-uaq-blue' : ''}`}
                        role="button"
                        tabIndex={0}
                        onKeyPress={(e) => e.key === 'Enter' && setSelectedChat(chat)}
                        aria-label={`Abrir chat con ${otherUser.name}`}
                    >
                        <img src={otherUser.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(otherUser.name)}&background=0D8ABC&color=fff&size=128`} alt={otherUser.name} className="w-10 h-10 rounded-full"/>
                        <div>
                        <p className="font-semibold">{otherUser.name}</p>
                        <p className="text-sm text-custom-gray-500 truncate w-40 md:w-48">{chat.lastMessage?.content}</p>
                        </div>
                        <span className="text-xs text-custom-gray-400 ml-auto self-start">{chat.lastMessage?.timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                    </div>
                    );
                })}
                {filteredChats.length === 0 && <p className="p-4 text-sm text-custom-gray-500">No hay chats. Intenta buscar un contacto.</p>}
                </div>
            </div>

            <div className="hidden md:flex w-2/3  flex-col bg-custom-gray-50">
                {selectedChat && selectedChat.participants.find(p => p.id !== mockCurrentUser.id) ? (
                <>
                    <div className="p-4 border-b bg-white flex items-center space-x-3">
                    <img src={selectedChat.participants.find(p => p.id !== mockCurrentUser.id)!.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(selectedChat.participants.find(p => p.id !== mockCurrentUser.id)!.name)}&background=0D8ABC&color=fff&size=128`} alt="avatar" className="w-10 h-10 rounded-full"/>
                    <h3 className="text-lg font-semibold text-uaq-blue">{selectedChat.participants.find(p => p.id !== mockCurrentUser.id)!.name}</h3>
                    </div>
                    <div className="flex-grow overflow-y-auto p-4 space-y-2">
                    {selectedChat.messages.map(msg => (
                        <div key={msg.id} className={`flex ${msg.senderId === mockCurrentUser.id ? 'justify-end' : 'justify-start'}`}>
                        <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${msg.senderId === mockCurrentUser.id ? 'bg-uaq-blue text-white' : 'bg-white shadow'}`}>
                            <p>{msg.content}</p>
                            <p className={`text-xs mt-1 ${msg.senderId === mockCurrentUser.id ? 'text-blue-200' : 'text-custom-gray-400'} text-right`}>{msg.timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>
                        </div>
                    ))}
                    </div>
                    <div className="p-4 border-t bg-white flex items-center space-x-2">
                    <Button variant="ghost" size="sm" title="Adjuntar archivo"><PaperClipIcon /></Button>
                    <Input 
                        type="text" 
                        placeholder="Escribe un mensaje..." 
                        className="flex-grow"
                        value={newMessage}
                        onChange={(e) => setNewMessage(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                        aria-label="Nuevo mensaje"
                    />
                    <Button onClick={handleSendMessage} title="Enviar mensaje"><PaperAirplaneIcon /></Button>
                    </div>
                </>
                ) : (
                <div className="flex-grow flex items-center justify-center text-custom-gray-500">
                    <p>Selecciona un chat para ver los mensajes o busca un contacto para iniciar uno nuevo.</p>
                </div>
                )}
            </div>
        </div>
    </div>
  );
};

const GradesPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const { courseId } = useParams<{ courseId?: string }>();
  const [selectedCourseId, setSelectedCourseId] = useState<string | undefined>(courseId || mockCourses[0]?.id);
  const [academicProgress, setAcademicProgress] = useState<GradeItem[]>([]);
  const [finalGrade, setFinalGrade] = useState<number | null>(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    setLoading(true);
    setTimeout(() => {
        if (selectedCourseId) {
            const progress = mockCourseAcademicProgress[selectedCourseId];
            if (progress) {
                setAcademicProgress(progress.grades);
                setFinalGrade(progress.finalGrade);
            } else {
                setAcademicProgress([]);
                setFinalGrade(null);
            }
        } else {
            setAcademicProgress([]);
            setFinalGrade(null);
        }
        setLoading(false);
    }, 500);
  }, [selectedCourseId]);

  const currentCourseName = mockCourses.find(c => c.id === selectedCourseId)?.name;

  const breadcrumbItems: BreadcrumbItem[] = [
    { label: 'Mis Cursos', path: '/' },
    { label: 'Calificaciones' }
  ];
  if(currentCourseName && selectedCourseId) {
    breadcrumbItems.push({ label: currentCourseName });
  }

  return (
    <div className="container mx-auto">
      <Breadcrumbs items={breadcrumbItems} navigate={navigate} />
      <div className="p-4 md:p-6 pt-0 md:pt-0">
        <div className="flex flex-col md:flex-row justify-between items-center mb-6">
            <h1 className="text-3xl font-bold text-uaq-blue mb-4 md:mb-0">Mis Calificaciones</h1>
            <select 
            value={selectedCourseId || ""} 
            onChange={(e) => {
                setSelectedCourseId(e.target.value);
                navigate(e.target.value ? `/grades/${e.target.value}`: '/grades');
            }}
            className="p-2 border border-custom-gray-300 rounded-md shadow-sm focus:ring-uaq-blue focus:border-uaq-blue"
            aria-label="Seleccionar curso para ver calificaciones"
            >
            <option value="">-- Selecciona un Curso --</option>
            {mockCourses.map(course => (
                <option key={course.id} value={course.id}>{course.name}</option>
            ))}
            </select>
        </div>

        {loading ? (
            <LoadingSpinner message="Cargando calificaciones..." />
        ) : selectedCourseId && academicProgress.length > 0 ? (
            <>
            <h2 className="text-xl font-semibold text-custom-gray-800 mb-4">Detalle de: {currentCourseName}</h2>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div className="lg:col-span-2 bg-white p-6 rounded-lg shadow">
                <h3 className="text-lg font-semibold text-uaq-blue mb-3">Listado de Calificaciones</h3>
                <div className="overflow-x-auto">
                    <table className="min-w-full divide-y divide-custom-gray-200">
                    <thead className="bg-custom-gray-50">
                        <tr>
                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-custom-gray-500 uppercase tracking-wider">Actividad/Evaluación</th>
                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-custom-gray-500 uppercase tracking-wider">Calificación</th>
                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-custom-gray-500 uppercase tracking-wider">Retroalimentación</th>
                        </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-custom-gray-200">
                        {academicProgress.map((item, index) => (
                        <tr key={index}>
                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-custom-gray-900">{item.activityName}</td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-custom-gray-500">
                            {item.grade !== null ? `${item.grade} / ${item.maxGrade}` : 'Pendiente'}
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-custom-gray-500">{item.feedback || '-'}</td>
                        </tr>
                        ))}
                    </tbody>
                    </table>
                </div>
                {finalGrade !== null && (
                    <div className="mt-6 text-right">
                    <p className="text-lg font-semibold">Calificación Final del Curso: <span className="text-uaq-blue text-xl">{finalGrade.toFixed(1)}</span></p>
                    </div>
                )}
                </div>
                <div className="lg:col-span-1">
                <GradesChart grades={academicProgress} />
                </div>
            </div>
            </>
        ) : selectedCourseId ? (
            <p className="text-center text-custom-gray-600 p-8">No hay calificaciones disponibles para este curso aún.</p>
        ) : (
            <p className="text-center text-custom-gray-600 p-8">Por favor, selecciona un curso para ver tus calificaciones.</p>
        )}
      </div>
    </div>
  );
};

const CalendarPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const [events, setEvents] = useState<CalendarEvent[]>(mockCalendarEvents);
  const today = new Date();
  const [currentMonth, setCurrentMonth] = useState(today.getMonth());
  const [currentYear, setCurrentYear] = useState(today.getFullYear());
  const academicCalendarImageUrl = "https://i.imgur.com/uR2XymL.jpeg";

  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
  const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay(); 
  
  const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

  const getEventsForDay = (day: number) => {
    return events.filter(event => {
      const eventDate = new Date(event.start);
      return eventDate.getFullYear() === currentYear && eventDate.getMonth() === currentMonth && eventDate.getDate() === day;
    });
  };
  
  const breadcrumbItems: BreadcrumbItem[] = [
    { label: 'Mis Cursos', path: '/' },
    { label: 'Calendario' }
  ];

  return (
    <div className="container mx-auto">
        <Breadcrumbs items={breadcrumbItems} navigate={navigate} />
        <div className="p-4 md:p-6 pt-0 md:pt-0">
            <h1 className="text-3xl font-bold text-uaq-blue mb-6">Calendario Académico</h1>

            <div className="bg-white p-6 rounded-lg shadow mb-6">
                <h2 className="text-xl font-semibold text-uaq-blue mb-3">Calendario Escolar Oficial UAQ</h2>
                 <img 
                    src={academicCalendarImageUrl} 
                    alt="Calendario Escolar UAQ 2025" 
                    className="w-full h-auto rounded-md shadow-sm object-contain max-h-[70vh]" 
                />
            </div>
            
            <div className="bg-white p-6 rounded-lg shadow">
                <div className="flex justify-between items-center mb-4">
                <Button onClick={() => {
                    if (currentMonth === 0) { setCurrentMonth(11); setCurrentYear(y => y - 1); }
                    else { setCurrentMonth(m => m - 1); }
                }}>&lt; Anterior</Button>
                <h2 className="text-xl font-semibold">{monthNames[currentMonth]} {currentYear}</h2>
                <Button onClick={() => {
                    if (currentMonth === 11) { setCurrentMonth(0); setCurrentYear(y => y + 1); }
                    else { setCurrentMonth(m => m + 1); }
                }}>Siguiente &gt;</Button>
                </div>
                <div className="grid grid-cols-7 gap-px border bg-custom-gray-200">
                {["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"].map(day => (
                    <div key={day} className="text-center font-semibold py-2 bg-custom-gray-100">{day}</div>
                ))}
                {Array.from({ length: firstDayOfMonth }).map((_, i) => <div key={`empty-${i}`} className="border bg-white min-h-[100px]"></div>)}
                {Array.from({ length: daysInMonth }).map((_, dayIndex) => {
                    const day = dayIndex + 1;
                    const dayEvents = getEventsForDay(day);
                    return (
                    <div key={day} className="border p-1 min-h-[100px] bg-white hover:bg-custom-gray-50 transition-colors">
                        <div className={`font-medium ${day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear() ? 'text-uaq-blue ring-1 ring-uaq-blue rounded-full w-6 h-6 flex items-center justify-center' : ''}`}>{day}</div>
                        <div className="text-xs space-y-0.5 mt-1">
                        {dayEvents.map(event => (
                            <div key={event.id} className="bg-uaq-gold text-uaq-blue p-0.5 rounded-sm truncate" title={`${event.title} - ${event.start.toLocaleTimeString()}`}>{event.title}</div>
                        ))}
                        </div>
                    </div>
                    );
                })}
                </div>
                <div className="mt-6 p-4 border-t border-custom-gray-200">
                    <h4 className="font-semibold text-uaq-blue mb-2">Integración con Google Calendar</h4>
                    <p className="text-sm text-custom-gray-600 mb-2">Sincroniza tus eventos académicos con Google Calendar.</p>
                    <Button variant="primary" size="sm" onClick={() => alert('Integración con Google Calendar (simulada)')}>Conectar Google Calendar</Button>
                </div>
            </div>
        </div>
    </div>
  );
};

const SettingsPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const [user, setUser] = useState(mockCurrentUser);
  const [isEditing, setIsEditing] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    setUser({ ...user, [e.target.name]: e.target.value });
  };

  const handleSave = () => {
    console.log("Saving user data:", user);
    setIsEditing(false);
    setShowSuccess(true);
    setTimeout(() => setShowSuccess(false), 3000);
  };
  
  const breadcrumbItems: BreadcrumbItem[] = [
    { label: 'Mis Cursos', path: '/' },
    { label: 'Configuración de Cuenta' }
  ];

  return (
    <div className="container mx-auto">
        <Breadcrumbs items={breadcrumbItems} navigate={navigate} />
        <div className="p-4 md:p-8 pt-0 md:pt-0">
            <h1 className="text-3xl font-bold text-uaq-blue mb-6">Configuración de Cuenta</h1>
            {showSuccess && (
                <div className="mb-4 p-3 bg-green-100 text-green-700 rounded-md shadow" role="alert">
                ¡Información guardada con éxito!
                </div>
            )}
            <div className="bg-white p-6 rounded-lg shadow max-w-2xl mx-auto">
                <div className="flex items-center space-x-4 mb-6">
                <img src={user.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=003366&color=fff&size=128`} alt={user.name} className="w-24 h-24 rounded-full object-cover"/>
                <div>
                    <h2 className="text-2xl font-semibold text-custom-gray-800">{user.name}</h2>
                    <p className="text-custom-gray-600">{user.email}</p>
                    <p className="text-sm text-uaq-gold capitalize">{user.role}</p>
                </div>
                </div>

                <form onSubmit={(e) => { e.preventDefault(); handleSave(); }}>
                <div className="space-y-4">
                    <Input label="Nombre Completo" name="name" value={user.name} onChange={handleInputChange} disabled={!isEditing} />
                    <Input label="Correo Electrónico" name="email" type="email" value={user.email} onChange={handleInputChange} disabled={!isEditing} />
                    <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Cambiar Contraseña</label>
                    <Input type="password" name="currentPassword" placeholder="Contraseña Actual" disabled={!isEditing} />
                    <Input type="password" name="newPassword" placeholder="Nueva Contraseña" className="mt-2" disabled={!isEditing} />
                    <Input type="password" name="confirmPassword" placeholder="Confirmar Nueva Contraseña" className="mt-2" disabled={!isEditing} />
                    </div>
                    <div>
                        <h3 className="text-lg font-semibold text-uaq-blue mt-6 mb-2">Preferencias</h3>
                        <label className="flex items-center space-x-2">
                            <input type="checkbox" className="form-checkbox text-uaq-blue focus:ring-uaq-gold" disabled={!isEditing}/>
                            <span>Recibir notificaciones por correo</span>
                        </label>
                        <label className="flex items-center space-x-2 mt-2">
                            <input type="checkbox" className="form-checkbox text-uaq-blue focus:ring-uaq-gold" defaultChecked disabled={!isEditing}/>
                            <span>Usar tema oscuro (si disponible)</span>
                        </label>
                    </div>
                </div>
                <div className="mt-8 flex justify-end space-x-3">
                    {isEditing ? (
                    <>
                        <Button type="button" variant="ghost" onClick={() => { setIsEditing(false); setUser(mockCurrentUser); }}>Cancelar</Button>
                        <Button type="submit" variant="primary">Guardar Cambios</Button>
                    </>
                    ) : (
                    <Button type="button" onClick={() => setIsEditing(true)}>Editar Perfil</Button>
                    )}
                </div>
                </form>
            </div>
        </div>
    </div>
  );
};

const LoginPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    if (!email || !password) {
      setError('Por favor, ingresa correo y contraseña.');
      return;
    }
    if (email === 'estudiante@uaq.mx' && password === 'password') {
      alert('Inicio de sesión exitoso!');
      navigate('/'); 
    } else {
      setError('Correo o contraseña incorrectos.');
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-custom-gray-100 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8 bg-white p-10 rounded-xl shadow-lg">
        <div>
          <img className="mx-auto h-20 w-auto" src="https://www.uaq.mx/CienciasNaturales/images/escudoColor.png" alt="UAQ" />
          <h2 className="mt-6 text-center text-3xl font-extrabold text-uaq-blue">
            Iniciar Sesión
          </h2>
        </div>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          {error && <p className="text-red-500 text-sm text-center" role="alert">{error}</p>}
          <Input 
            id="email" 
            name="email" 
            type="email" 
            autoComplete="email" 
            required 
            placeholder="Correo Electrónico" 
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            aria-describedby={error ? "error-message" : undefined}
          />
          <Input 
            id="password" 
            name="password" 
            type="password" 
            autoComplete="current-password" 
            required 
            placeholder="Contraseña" 
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            aria-describedby={error ? "error-message" : undefined}
          />
          {error && <span id="error-message" className="sr-only">{error}</span>}
          <div className="flex items-center justify-between">
            <div className="flex items-center">
              <input id="remember-me" name="remember-me" type="checkbox" className="h-4 w-4 text-uaq-blue focus:ring-uaq-gold border-custom-gray-300 rounded" />
              <label htmlFor="remember-me" className="ml-2 block text-sm text-custom-gray-900"> Recordarme </label>
            </div>
            <div className="text-sm">
              <a href="#/forgot-password" onClick={(e) => { e.preventDefault(); navigate('/forgot-password');}} className="font-medium text-uaq-gold hover:text-uaq-blue"> ¿Olvidaste tu contraseña? </a>
            </div>
          </div>
          <div>
            <Button type="submit" className="w-full">
              Ingresar
            </Button>
          </div>
        </form>
        <p className="mt-4 text-center text-sm text-custom-gray-600">
          ¿No tienes cuenta?{' '}
          <a href="#/register" onClick={(e) => { e.preventDefault(); navigate('/register');}} className="font-medium text-uaq-gold hover:text-uaq-blue">
            Regístrate aquí
          </a>
        </p>
      </div>
    </div>
  );
};

const RegisterPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    alert('Registro simulado exitoso!');
    navigate('/login');
  };
  return (
    <div className="min-h-screen flex items-center justify-center bg-custom-gray-100 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8 bg-white p-10 rounded-xl shadow-lg">
        <div>
           <img className="mx-auto h-20 w-auto" src="https://www.uaq.mx/CienciasNaturales/images/escudoColor.png" alt="UAQ" />
          <h2 className="mt-6 text-center text-3xl font-extrabold text-uaq-blue">
            Crear Nueva Cuenta
          </h2>
        </div>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          <Input id="fullName" name="fullName" type="text" required placeholder="Nombre Completo" />
          <Input id="email" name="email" type="email" required placeholder="Correo Electrónico Institucional" />
          <Input id="studentId" name="studentId" type="text" required placeholder="Expediente / Número de Empleado" />
          <Input id="password" name="password" type="password" required placeholder="Contraseña" />
          <Input id="confirmPassword" name="confirmPassword" type="password" required placeholder="Confirmar Contraseña" />
          <p className="text-xs text-custom-gray-500">La contraseña debe tener al menos 8 caracteres, una mayúscula, una minúscula y un número.</p>
          <div>
            <Button type="submit" className="w-full">
              Registrarse
            </Button>
          </div>
        </form>
         <p className="mt-4 text-center text-sm text-custom-gray-600">
          ¿Ya tienes cuenta?{' '}
          <a href="#/login" onClick={(e) => { e.preventDefault(); navigate('/login');}} className="font-medium text-uaq-gold hover:text-uaq-blue">
            Inicia sesión
          </a>
        </p>
      </div>
    </div>
  );
};

const ForgotPasswordPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    alert('Se ha enviado un correo con instrucciones para recuperar tu contraseña (simulado).');
    navigate('/login');
  };
  return (
    <div className="min-h-screen flex items-center justify-center bg-custom-gray-100 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8 bg-white p-10 rounded-xl shadow-lg">
        <div>
          <img className="mx-auto h-20 w-auto" src="https://www.uaq.mx/CienciasNaturales/images/escudoColor.png" alt="UAQ" />
          <h2 className="mt-6 text-center text-3xl font-extrabold text-uaq-blue">
            Recuperar Contraseña
          </h2>
           <p className="mt-2 text-center text-sm text-custom-gray-600">
            Ingresa tu correo electrónico institucional y te enviaremos un enlace para restablecer tu contraseña.
          </p>
        </div>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          <Input id="email" name="email" type="email" required placeholder="Correo Electrónico Institucional" />
          <div>
            <Button type="submit" className="w-full">
              Enviar Enlace de Recuperación
            </Button>
          </div>
        </form>
         <p className="mt-4 text-center text-sm text-custom-gray-600">
          <a href="#/login" onClick={(e) => { e.preventDefault(); navigate('/login');}} className="font-medium text-uaq-gold hover:text-uaq-blue">
            Volver a Iniciar Sesión
          </a>
        </p>
      </div>
    </div>
  );
};

const HelpPage: React.FC<{ navigate: (path: string) => void }> = ({ navigate }) => {
    const breadcrumbItems: BreadcrumbItem[] = [
      { label: 'Mis Cursos', path: '/' },
      { label: 'Ayuda y Soporte' }
    ];
  
    return (
      <div className="container mx-auto">
        <Breadcrumbs items={breadcrumbItems} navigate={navigate} />
        <div className="p-4 md:p-8 pt-0 md:pt-0">
            <h1 className="text-3xl font-bold text-uaq-blue mb-6">Ayuda y Soporte</h1>
            <div className="bg-white p-6 rounded-lg shadow space-y-6">
            <section>
                <h2 className="text-xl font-semibold text-uaq-blue mb-3">Preguntas Frecuentes (FAQ)</h2>
                <div className="space-y-4">
                <div>
                    <h3 className="font-semibold text-custom-gray-800">¿Cómo puedo ver mis cursos?</h3>
                    <p className="text-custom-gray-700">Puedes ver todos tus cursos inscritos en la página principal "Mis Cursos" después de iniciar sesión.</p>
                </div>
                <div>
                    <h3 className="font-semibold text-custom-gray-800">¿Dónde encuentro el material de un curso?</h3>
                    <p className="text-custom-gray-700">Dentro de cada curso, navega a la pestaña "Material". Allí encontrarás los recursos compartidos por tu profesor.</p>
                </div>
                <div>
                    <h3 className="font-semibold text-custom-gray-800">¿Cómo entrego una actividad?</h3>
                    <p className="text-custom-gray-700">Ve a la sección "Actividades" de tu curso, selecciona la actividad y utiliza el panel de entrega para subir tu archivo. Asegúrate de confirmar la entrega.</p>
                </div>
                </div>
            </section>
            <section className="border-t pt-6">
                <h2 className="text-xl font-semibold text-uaq-blue mb-3">Contactar Soporte Técnico</h2>
                <p className="text-custom-gray-700">Si necesitas asistencia adicional o tienes problemas técnicos, por favor contacta al equipo de soporte de la Facultad de Informática:</p>
                <p className="mt-2"><strong>Correo:</strong> <a href="mailto:soporte.informatica@uaq.mx" className="text-uaq-gold hover:underline">soporte.informatica@uaq.mx</a></p>
                <p className="mt-1"><strong>Teléfono:</strong> (442) 123 4567 Ext. 101 (Horario de atención: L-V 9am - 5pm)</p>
            </section>
            </div>
        </div>
      </div>
    );
  };
  
// Content from App.tsx
import React, { useState, useEffect } from 'react'; // React, useState, useEffect for App
import { HashRouter, Routes, Route, Navigate, useNavigate, useLocation } from 'react-router-dom'; // Router components and hooks for App

// Pages and Components are now globally available in this script block.
// Direct imports from './pages' and './components' are removed.

const AppContent: React.FC = () => {
  const navigate = useNavigate(); 
  const location = useLocation(); 
  const [showSearchResultsModal, setShowSearchResultsModal] = useState(false);
  const [searchResults, setSearchResults] = useState<{id: string, name: string, type: string, link: string}[]>([]);

  const handleFacultySearch = (term: string) => {
    if (!term.trim()) {
      setSearchResults([]);
      return;
    }
    const results = mockFacultyResources.filter(res => 
      res.name.toLowerCase().includes(term.toLowerCase()) || 
      res.type.toLowerCase().includes(term.toLowerCase())
    );
    setSearchResults(results);
  };
  
  const noHeaderPaths = ['/login', '/register', '/forgot-password'];
  const showHeader = !noHeaderPaths.includes(location.pathname);

  const [isAuthenticated, setIsAuthenticated] = useState(true); 

  useEffect(() => {
    if (!isAuthenticated && !noHeaderPaths.includes(location.pathname)) {
      navigate('/login');
    }
  }, [isAuthenticated, location.pathname, navigate]);

  return (
    <div className="flex flex-col min-h-screen bg-custom-gray-100">
      {showHeader && isAuthenticated && (
         <GeneralHeader 
            notifications={mockNotifications} 
            onSearch={handleFacultySearch} 
            setShowSearchResultsModal={setShowSearchResultsModal}
            navigate={navigate}
          />
      )}
      <main className={`flex-grow ${showHeader && isAuthenticated ? 'pt-0' : ''}`}>
        <Routes>
          <Route path="/login" element={<LoginPage navigate={navigate} />} />
          <Route path="/register" element={<RegisterPage navigate={navigate} />} />
          <Route path="/forgot-password" element={<ForgotPasswordPage navigate={navigate} />} />

          <Route path="/" element={isAuthenticated ? <DashboardPage navigate={navigate} /> : <Navigate to="/login" />} />
          <Route path="/course/:courseId/*" element={isAuthenticated ? <CoursePage navigate={navigate} /> : <Navigate to="/login" />} />
          <Route path="/course/:courseId/activity/:activityId" element={isAuthenticated ? <ActivityDetailPage navigate={navigate} /> : <Navigate to="/login" />} />
          <Route path="/messaging" element={isAuthenticated ? <MessagingPage navigate={navigate} /> : <Navigate to="/login" />} />
          <Route path="/grades" element={isAuthenticated ? <GradesPage navigate={navigate} /> : <Navigate to="/login" />} />
          <Route path="/grades/:courseId" element={isAuthenticated ? <GradesPage navigate={navigate} /> : <Navigate to="/login" />} />
          <Route path="/calendar" element={isAuthenticated ? <CalendarPage navigate={navigate} /> : <Navigate to="/login" />} />
          <Route path="/settings/*" element={isAuthenticated ? <SettingsPage navigate={navigate} /> : <Navigate to="/login" />} />
          <Route path="/help" element={isAuthenticated ? <HelpPage navigate={navigate} /> : <Navigate to="/login" />} />
          
          <Route path="*" element={isAuthenticated ? <Navigate to="/" /> : <Navigate to="/login" />} />
        </Routes>
      </main>
      <Modal 
        isOpen={showSearchResultsModal} 
        onClose={() => setShowSearchResultsModal(false)}
        title="Resultados de Búsqueda de Recursos"
        size="lg"
      >
        <ResourceSearchResults results={searchResults} />
      </Modal>
    </div>
  );
};

const App: React.FC = () => {
  return (
    <HashRouter>
      <AppContent />
    </HashRouter>
  );
};

// Content from index.tsx
import React from 'react'; // React for JSX
import ReactDOM from 'react-dom/client';

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>